import{u as ue,r as m,j as a,b as de,a as me,p as pe}from"./index-06c6c1f5.js";import{G as he}from"./index.esm-c4f99d41.js";import{c as ye}from"./index-0b99c69c.js";import{a as C}from"./alertMessage-026c37b5.js";import{M as _e}from"./index.esm-a526b47c.js";import{P as xe}from"./index.esm-bcf7d115.js";import{G as ge}from"./iconBase-51491e03.js";import{S as we}from"./ScrollTop-7e4dffaf.js";import{P as ve}from"./PopUpModal-a427d51e.js";import{W as be}from"./WriteText-248b936c.js";import{B as J}from"./Button-e722f406.js";import{H as je}from"./Header-49b89639.js";import{M as Pe}from"./MetaData-baa07fc2.js";import"./index-ea9f9059.js";const Q={writer:"",contents:"",photos:null,keywords:null,place:"",reservation:""},z=ye(e=>({reviewData:{...Q},setReviewData:t=>e(r=>({reviewData:{...r.reviewData,...t}})),resetReviewData(){e({reviewData:{...Q}})}}));function Ce(){const{userId:e,item:t}=ue().state||{},{setReviewData:r}=z();return m.useEffect(()=>{r({writer:e,place:t.expand.place.id,reservation:t.id})},[e,t.expand.place.id,t.id,r]),a.jsxs("div",{className:"border-b pb-2 w-full",children:[a.jsx("h1",{className:"text-lg font-semibold",children:t.expand.place.title}),a.jsxs("p",{children:[t.expand.place.category,a.jsx("span",{className:"mx-1",children:"|"}),t.expand.place.address]})]})}const De=[{id:"keyword-1",name:"😊 친절해요"},{id:"keyword-2",name:"🏢 매장이 넓어요"},{id:"keyword-3",name:"✨ 매장이 청결해요"},{id:"keyword-4",name:"🌆 인테리어가 멋져요"},{id:"keyword-5",name:"👀 뷰가 좋아요"},{id:"keyword-6",name:"🤩 맛있어요"},{id:"keyword-7",name:"🍚 양이 많아요"},{id:"keyword-8",name:"💰 가성비가 좋아요"},{id:"keyword-9",name:"🚗 주차하기 편해요"},{id:"keyword-10",name:"🌡 냉난방이 잘돼요"}];function Z(){const e=z(i=>i.reviewData),t=z(i=>i.setReviewData),r=z(i=>i.resetReviewData),n=m.useCallback(i=>{const{name:s,value:o}=i.target;t({[s]:o})},[t]);return m.useMemo(()=>({reviewData:e,setReviewData:t,handleInputChange:n,resetReviewData:r}),[n,e,t,r])}var ie=Symbol.for("immer-nothing"),V=Symbol.for("immer-draftable"),u=Symbol.for("immer-state");function h(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var j=Object.getPrototypeOf;function P(e){return!!e&&!!e[u]}function v(e){var t;return e?se(e)||Array.isArray(e)||!!e[V]||!!((t=e.constructor)!=null&&t[V])||F(e)||I(e):!1}var Ne=Object.prototype.constructor.toString();function se(e){if(!e||typeof e!="object")return!1;const t=j(e);if(t===null)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Ne}function D(e,t){M(e)===0?Object.entries(e).forEach(([r,n])=>{t(r,n,e)}):e.forEach((r,n)=>t(n,r,e))}function M(e){const t=e[u];return t?t.type_:Array.isArray(e)?1:F(e)?2:I(e)?3:0}function G(e,t){return M(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function ae(e,t,r){const n=M(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function ke(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function F(e){return e instanceof Map}function I(e){return e instanceof Set}function w(e){return e.copy_||e.base_}function B(e,t){if(F(e))return new Map(e);if(I(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&se(e))return j(e)?{...e}:Object.assign(Object.create(null),e);const r=Object.getOwnPropertyDescriptors(e);delete r[u];let n=Reflect.ownKeys(r);for(let i=0;i<n.length;i++){const s=n[i],o=r[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(r[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[s]})}return Object.create(j(e),r)}function $(e,t=!1){return E(e)||P(e)||!v(e)||(M(e)>1&&(e.set=e.add=e.clear=e.delete=Se),Object.freeze(e),t&&D(e,(r,n)=>$(n,!0))),e}function Se(){h(2)}function E(e){return Object.isFrozen(e)}var ze={};function b(e){const t=ze[e];return t||h(0,e),t}var N;function oe(){return N}function Oe(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function ee(e,t){t&&(b("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function K(e){W(e),e.drafts_.forEach(Re),e.drafts_=null}function W(e){e===N&&(N=e.parent_)}function te(e){return N=Oe(N,e)}function Re(e){const t=e[u];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function re(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[u].modified_&&(K(t),h(4)),v(e)&&(e=O(t,e),t.parent_||R(t,e)),t.patches_&&b("Patches").generateReplacementPatches_(r[u].base_,e,t.patches_,t.inversePatches_)):e=O(t,r,[]),K(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==ie?e:void 0}function O(e,t,r){if(E(t))return t;const n=t[u];if(!n)return D(t,(i,s)=>ne(e,n,t,i,s,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return R(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const i=n.copy_;let s=i,o=!1;n.type_===3&&(s=new Set(i),i.clear(),o=!0),D(s,(c,l)=>ne(e,n,i,c,l,r,o)),R(e,i,!1),r&&e.patches_&&b("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function ne(e,t,r,n,i,s,o){if(P(i)){const c=s&&t&&t.type_!==3&&!G(t.assigned_,n)?s.concat(n):void 0,l=O(e,i,c);if(ae(r,n,l),P(l))e.canAutoFreeze_=!1;else return}else o&&r.add(i);if(v(i)&&!E(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;O(e,i),(!t||!t.scope_.parent_)&&R(e,i)}}function R(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&$(t,r)}function Ae(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:oe(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=n,s=L;r&&(i=[n],s=k);const{revoke:o,proxy:c}=Proxy.revocable(i,s);return n.draft_=c,n.revoke_=o,c}var L={get(e,t){if(t===u)return e;const r=w(e);if(!G(r,t))return Me(e,r,t);const n=r[t];return e.finalized_||!v(n)?n:n===T(e.base_,t)?(U(e),e.copy_[t]=H(n,e)):n},has(e,t){return t in w(e)},ownKeys(e){return Reflect.ownKeys(w(e))},set(e,t,r){const n=ce(w(e),t);if(n!=null&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const i=T(w(e),t),s=i==null?void 0:i[u];if(s&&s.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(ke(r,i)&&(r!==void 0||G(e.base_,t)))return!0;U(e),X(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return T(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,U(e),X(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=w(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){h(11)},getPrototypeOf(e){return j(e.base_)},setPrototypeOf(){h(12)}},k={};D(L,(e,t)=>{k[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});k.deleteProperty=function(e,t){return k.set.call(this,e,t,void 0)};k.set=function(e,t,r){return L.set.call(this,e[0],t,r,e[0])};function T(e,t){const r=e[u];return(r?w(r):e)[t]}function Me(e,t,r){var i;const n=ce(t,r);return n?"value"in n?n.value:(i=n.get)==null?void 0:i.call(e.draft_):void 0}function ce(e,t){if(!(t in e))return;let r=j(e);for(;r;){const n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=j(r)}}function X(e){e.modified_||(e.modified_=!0,e.parent_&&X(e.parent_))}function U(e){e.copy_||(e.copy_=B(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Fe=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){const s=r;r=t;const o=this;return function(l=s,...g){return o.produce(l,y=>r.call(this,y,...g))}}typeof r!="function"&&h(6),n!==void 0&&typeof n!="function"&&h(7);let i;if(v(t)){const s=te(this),o=H(t,void 0);let c=!0;try{i=r(o),c=!1}finally{c?K(s):W(s)}return ee(s,n),re(i,s)}else if(!t||typeof t!="object"){if(i=r(t),i===void 0&&(i=t),i===ie&&(i=void 0),this.autoFreeze_&&$(i,!0),n){const s=[],o=[];b("Patches").generateReplacementPatches_(t,i,s,o),n(s,o)}return i}else h(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(o,...c)=>this.produceWithPatches(o,l=>t(l,...c));let n,i;return[this.produce(t,r,(o,c)=>{n=o,i=c}),n,i]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){v(e)||h(8),P(e)&&(e=Ie(e));const t=te(this),r=H(e,void 0);return r[u].isManual_=!0,W(t),r}finishDraft(e,t){const r=e&&e[u];(!r||!r.isManual_)&&h(9);const{scope_:n}=r;return ee(n,t),re(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const i=t[r];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}r>-1&&(t=t.slice(r+1));const n=b("Patches").applyPatches_;return P(e)?n(e,t):this.produce(e,i=>n(i,t))}};function H(e,t){const r=F(e)?b("MapSet").proxyMap_(e,t):I(e)?b("MapSet").proxySet_(e,t):Ae(e,t);return(t?t.scope_:oe()).drafts_.push(r),r}function Ie(e){return P(e)||h(10,e),le(e)}function le(e){if(!v(e)||E(e))return e;const t=e[u];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=B(e,t.scope_.immer_.useStrictShallowCopy_)}else r=B(e,!0);return D(r,(n,i)=>{ae(r,n,le(i))}),t&&(t.finalized_=!1),r}var d=new Fe,A=d.produce;d.produceWithPatches.bind(d);d.setAutoFreeze.bind(d);d.setUseStrictShallowCopy.bind(d);d.applyPatches.bind(d);d.createDraft.bind(d);d.finishDraft.bind(d);function Ee(){const{handleInputChange:e}=Z(),[t,r]=m.useState([]);m.useEffect(()=>{e({target:{name:"keywords",value:t}})},[e,t]);const n=s=>{t.includes(s)?r(A(t,o=>{o.splice(o.indexOf(s),1)})):t.length<5?r(A(t,o=>{o.push(s)})):C("최대 5개까지만 선택할 수 있습니다.","❗")},i=De.map(s=>a.jsx("li",{className:"mb-2",children:a.jsx("button",{type:"button",className:`min-w-max rounded px-3 py-2 shadow-sm shadow-slate-300 
        ${t.includes(s.name)?"bg-primary text-white":"bg-gray-100 text-black"}`,onClick:()=>n(s.name),children:s.name})},s.id));return a.jsxs("div",{className:"flex w-full flex-col flex-wrap gap-2 self-center",children:[a.jsxs("p",{className:"mt-5 text-center text-lg font-semibold",children:["어떤 점이 좋았나요?",a.jsx("span",{className:"text-sm",children:"(1개~5개)"})]}),a.jsx("ul",{className:"flex flex-wrap justify-center gap-x-1 text-xs text-white",children:i})]})}function Te(e){return ge({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{id:"Image_On"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{d:"M18.435,3.06H5.565a2.5,2.5,0,0,0-2.5,2.5V18.44a2.507,2.507,0,0,0,2.5,2.5h12.87a2.507,2.507,0,0,0,2.5-2.5V5.56A2.5,2.5,0,0,0,18.435,3.06ZM4.065,5.56a1.5,1.5,0,0,1,1.5-1.5h12.87a1.5,1.5,0,0,1,1.5,1.5v8.66l-3.88-3.88a1.509,1.509,0,0,0-2.12,0l-4.56,4.57a.513.513,0,0,1-.71,0l-.56-.56a1.522,1.522,0,0,0-2.12,0l-1.92,1.92Zm15.87,12.88a1.5,1.5,0,0,1-1.5,1.5H5.565a1.5,1.5,0,0,1-1.5-1.5v-.75L6.7,15.06a.5.5,0,0,1,.35-.14.524.524,0,0,1,.36.14l.55.56a1.509,1.509,0,0,0,2.12,0l4.57-4.57a.5.5,0,0,1,.71,0l4.58,4.58Z"}},{tag:"path",attr:{d:"M8.062,10.565a2.5,2.5,0,1,1,2.5-2.5A2.5,2.5,0,0,1,8.062,10.565Zm0-4a1.5,1.5,0,1,0,1.5,1.5A1.5,1.5,0,0,0,8.062,6.565Z"}}]}]}]})(e)}function fe({name:e}){const{handleInputChange:r}=Z(),[n,i]=m.useState({fileImages:[],imageCount:0}),[s,o]=m.useState(!1),c=m.useRef(null),l=m.useRef(null),g=m.useRef(null),y=f=>f.current.style.display="none",p=f=>f.current.style.display="flex",_=f=>{const{files:x}=f.target;if(x.length+n.fileImages.length>5){C("최대 5장까지 추가할 수 있습니다.","❗");return}i(A(Y=>{Y.fileImages.push(...Array.from(x).map(q=>({image:URL.createObjectURL(q),label:q.name}))),Y.imageCount+=x.length}))},S=f=>{i(A(x=>{x.fileImages.splice(f,1),x.imageCount-=1})),n.imageCount<=1&&(p(g),y(l))};return m.useEffect(()=>{n.imageCount<=0?(p(g),y(l)):(p(l),y(g))},[n]),a.jsxs("div",{className:"flex flex-col w-full",children:[a.jsxs("label",{htmlFor:"photos",ref:g,className:` flex justify-center items-center gap-1 py-1 border rounded font-semibold w-full self-center hover:cursor-pointer ${s?"outline outline-2 border-white":"border-primary"}`,children:[a.jsx(Te,{}),"사진추가",a.jsxs("span",{className:"text-slate-400 text-xs",children:["최대 ",5,"장"]})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"file",accept:"*.jpg,*.png,*.jpeg,*.webp,*.avif",ref:c,multiple:!0,name:"photos",id:"photos",onChange:f=>{_(f),r({target:{name:e,value:f.target.files}})},onFocus:()=>o(!0),onBlur:()=>o(!1),className:"absolute z-10 h-4/5 w-full opacity-0 hover:cursor-pointer"}),a.jsxs("div",{className:"flex gap-4",ref:l,children:[a.jsx("div",{className:"flex border border-primary rounded gap-2 p-2 h-36 w-full overflow-auto",children:n.fileImages.map((f,x)=>a.jsxs("div",{className:"relative shrink-0",children:[a.jsx("img",{src:f.image,alt:f.label,className:"h-full"}),a.jsx("button",{type:"button",onClick:()=>S(x),className:"absolute top-[2px] right-[2px] text-primary z-10","aria-label":`이미지 ${x+1} 삭제`,children:a.jsx(_e,{size:"20"})})]},x))}),a.jsxs("div",{className:"flex flex-col justify-center items-center text-primary",children:[a.jsx(xe,{className:"w-20 h-20"}),a.jsxs("p",{className:"font-bold",children:[n.imageCount,"/",5]})]})]})]})]})}fe.propTypes={name:de.string};function Ve(){const e=me(),[t,r]=m.useState(!1),{handleInputChange:n,reviewData:i,resetReviewData:s}=Z(),o=y=>{for(const p in y){if(p==="canceled"||p==="visited")break;const _=y[p];if(!_&&_!==0)return!1}return!0},c=async y=>{if(y.preventDefault(),!o(i)){C("공란이 있습니다.","❗");return}const p=new FormData;for(const[_,S]of Object.entries(i))if(_==="photos"||_==="keywords")for(let f of S)p.append(_,f);else p.append(_,S);try{await pe.collection("reviews").create(p),C("리뷰가 등록되었습니다."),s(),e("/reservation")}catch{C("요청하신 작업을 수행하지 못했습니다.","❗")}},l=()=>{s(),e(-1)},g={title:"Best Place - 리뷰작성",description:"예약에 대한 리뷰 작성",keywords:["리뷰","기록","후기","맛집기행"],image:"/public/logo.svg"};return a.jsxs(a.Fragment,{children:[a.jsx(Pe,{props:g}),a.jsx(we,{}),a.jsx(ve,{openModal:t,setOpenModal:r,modalTitle:"정말 취소하시겠습니까?",actionTitle:"확인",handleEvent:l}),a.jsx(je,{}),a.jsxs("main",{className:"relative mx-auto mb-10 max-w-3xl px-3",children:[a.jsx("button",{onClick:()=>r(!0),className:"absolute right-2",children:a.jsx(he,{className:"text-2xl"})}),a.jsxs("form",{method:"POST",className:"mx-auto mt-4 flex flex-col flex-wrap gap-4",children:[a.jsx(Ce,{}),a.jsx(be,{label:"리뷰를 남겨주세요",placeholder:"업주와 다른 사용자들이 상처받지 않도록 좋은 표현을 사용해주세요. 유용한 Tip도 남겨주세요!",name:"contents",value:i.contents,onChange:n}),a.jsx(fe,{name:"photos"}),a.jsx(Ee,{name:"keywords"}),a.jsxs("div",{className:"focus:bg-opacity-80 bottom-0 sticky z-10 flex gap-2 bg-gradient-to-b from-white/10 from-10% to-white to-40% pb-3 pt-8 hover:bg-opacity-80",children:[a.jsx(J,{text:"취소하기",onClick:()=>r(!0),bgColor:"bg-gray-100",textColor:"text-red-500"}),a.jsx(J,{type:"submit",text:"등록하기",onClick:c})]})]})]})]})}export{Ve as default};
