import{b as d,d as j,p as f,r as w,j as e,L as b,u as N,S as v}from"./index-06c6c1f5.js";import{F as I,S as k}from"./ScrollTopButton-3739b1c5.js";import{F}from"./FeedItem-6bacd1df.js";import{M as L}from"./MetaData-baa07fc2.js";import{u as P}from"./useFetchList-8f652331.js";import{g as S}from"./getPbImageURL-ebcdbcbf.js";import{I as E}from"./index.esm-e904fcbc.js";import{u as R,a as $}from"./region-43499ee0.js";import{H as T}from"./Header-49b89639.js";import"./index.esm-bcf7d115.js";import"./iconBase-51491e03.js";import"./getDate-b10b504c.js";import"./FeedItemHeader-aa1df1b8.js";import"./follow-af2673d1.js";import"./index-0b99c69c.js";import"./index-ea9f9059.js";import"./middleware-763781cb.js";import"./debounce-1252dfff.js";import"./useQuery-7f8ad36b.js";import"./useBaseQuery-d5fe4309.js";import"./index.esm-1ff9b723.js";import"./swiper-a857a5c8.js";import"./PopUpModal-a427d51e.js";import"./index.esm-a526b47c.js";function g({item:n}){const{userId:o}=j(),t=f.authStore.model.id,[m,c]=w.useState(!1),{data:s,refetch:a}=P("follow",{expand:"owner"});w.useEffect(()=>{const l=s==null?void 0:s.filter(r=>r.expand.owner.id===t)[0].followings;l!=null&&l.includes(o)?c(!0):c(!1)},[s,t,o]);const p=async()=>{let l,r;const x=s==null?void 0:s.filter(i=>i.expand.owner.id===t)[0].id,h=s==null?void 0:s.filter(i=>i.expand.owner.id===t)[0].followings,y=s==null?void 0:s.filter(i=>i.expand.owner.id===o)[0].id,u=s==null?void 0:s.filter(i=>i.expand.owner.id===o)[0].followers;m?(l=h.filter(i=>i!==o),r=u.filter(i=>i!==t),c(!1)):(l=[...h,o],r=[...u,t],c(!0));try{await f.collection("follow").update(x,{followings:l}),await f.collection("follow").update(y,{followers:r})}catch(i){console.error(i)}a()};return e.jsx("header",{className:"sticky top-[-4px] z-10 bg-gray-50 py-4 shadow-[0_6px_6px_-2px_rgba(0,0,0,0.1)]",children:e.jsxs("div",{className:"mx-auto flex max-w-3xl items-center justify-between px-3",children:[e.jsx(b,{to:t===o?"/my-review":`/user-review/${o}`,children:e.jsxs("dl",{className:"flex items-center gap-1",children:[e.jsx("dt",{className:"sr-only",children:"작성자 프로필"}),e.jsx("dd",{className:"mr-1 h-7 w-7 rounded-full bg-gray-300",children:n.expand.writer.avatar?e.jsx("img",{src:S(n.expand.writer,n.expand.writer.avatar),alt:"작성자 프로필",className:"h-full w-full rounded-full object-cover text-xs"}):e.jsx(E,{className:"h-full w-full text-gray-100"})}),e.jsx("dt",{className:"sr-only",children:"작성자"}),t===o?e.jsx("dd",{className:"font-bold",children:e.jsx("span",{className:"text-base font-semibold",children:"MY 플레이스"})}):e.jsxs("dd",{className:"font-bold",children:[n.expand.writer.nickname,e.jsx("span",{className:"text-base font-semibold",children:" 님의 플레이스"})]})]})}),t===o?e.jsx("div",{}):m?e.jsx("button",{className:"h-8 rounded-md bg-gray-100 px-3 text-sm text-gray-500",onClick:p,children:"팔로우 취소"}):e.jsx("button",{className:"h-8 rounded-md bg-secondary px-3 text-sm text-white",onClick:p,children:"팔로우"})]})})}g.propTypes={item:d.shape({expand:d.shape({writer:d.shape({id:d.string,avatar:d.string,nickname:d.string})})})};function oe(){const{userId:n}=j(),o=N().state,{data:t,isLoading:m,hasNextPage:c,fetchNextPage:s}=R("reviews",{filter:`writer.id='${n}'`}),a=t==null?void 0:t.flatMap(r=>r.items);w.useEffect(()=>{const r=a&&document.getElementById(o).offsetTop;window.scrollTo({top:r-100})},[o,a]);const p=$(async(r,x)=>{x.unobserve(r.target),c&&!m&&s()},{threshold:1});if(m)return e.jsx(v,{});const l={title:`Best Place - ${a[0].expand.writer.nickname}의 리뷰 리스트`,description:`${a[0].expand.writer.nickname}가 작성한 리뷰 리스트`,keywords:[`${a[0].expand.writer.nickname}`,"리뷰","맛집후기"],image:`${t[0].items[0].photos}`};return e.jsxs("div",{className:"relative min-h-screen pb-28",children:[e.jsx(L,{props:l}),e.jsx(T,{}),a&&e.jsx(g,{item:a[0]}),e.jsxs("main",{className:"mx-auto max-w-3xl p-3",children:[e.jsx("h2",{className:"sr-only",children:"유저 리뷰리스트 페이지"}),e.jsx("ul",{className:"flex flex-col gap-1 bg-gray-50",children:a==null?void 0:a.map(r=>e.jsx("li",{id:r.id,children:e.jsx(F,{item:r,hiddenHeader:!0,isPlace:!0})},r.id))}),e.jsx("div",{ref:p,className:"h-[1px]"})]}),e.jsx(I,{}),e.jsx("div",{className:"fixed bottom-4 right-4 z-10 flex flex-col gap-3 text-white",children:e.jsx(k,{})})]})}export{oe as default};
