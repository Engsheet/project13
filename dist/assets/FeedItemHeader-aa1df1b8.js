import{b as i,p as f,r as w,j as r,L as C}from"./index-06c6c1f5.js";import{u as p}from"./useFetchList-8f652331.js";import{u as S}from"./follow-af2673d1.js";import{d as N}from"./debounce-1252dfff.js";import{g as E}from"./getPbImageURL-ebcdbcbf.js";import{I as L}from"./index.esm-e904fcbc.js";function R({item:t,isUser:n}){const l=f.authStore.model.id,[h,c]=w.useState(!1),[v,u]=w.useState(!1),{setFollowCount:m}=S(),{data:e,refetch:$}=p("follow",{expand:"owner"}),{data:x}=p("reviews",{filter:`writer='${t.writer}'`}),{data:g,refetch:I}=p("follow",{filter:`owner='${t.writer}'`});w.useEffect(()=>{const o=e==null?void 0:e.filter(d=>d.expand.owner.id===l)[0].followings,a=e==null?void 0:e.filter(d=>d.expand.owner.id===l)[0].followers;m(o==null?void 0:o.length,a==null?void 0:a.length),o!=null&&o.includes(t.expand.writer.id)?c(!0):c(!1)},[e,l,m,t]);const b=async o=>{let a,d;const F=e==null?void 0:e.filter(s=>s.expand.owner.id===l)[0].id,j=e==null?void 0:e.filter(s=>s.expand.owner.id===l)[0].followings,k=e==null?void 0:e.filter(s=>s.expand.owner.id===o.target.id)[0].id,y=e==null?void 0:e.filter(s=>s.expand.owner.id===o.target.id)[0].followers;h?(a=j.filter(s=>s!==t.expand.writer.id),d=y.filter(s=>s!==l),c(!1)):(a=[...j,t.expand.writer.id],d=[...y,l],c(!0));try{await f.collection("follow").update(F,{followings:a}),await f.collection("follow").update(k,{followers:d})}catch(s){console.error(s)}$(),I()};return r.jsxs("div",{className:`${!n||"mx-auto max-w-3xl p-3"} flex items-center justify-between`,children:[r.jsx(C,{to:l===t.expand.writer.id?"my-review":`/user-review/${t.expand.writer.id}`,className:"group",children:r.jsxs("dl",{className:"grid items-center gap-x-1",children:[r.jsx("dt",{className:"sr-only",children:"작성자 프로필"}),r.jsx("dd",{className:`${n?"h-16 w-16":"h-12 w-12"} col-start-1 row-start-1 row-end-3 mr-1 rounded-full bg-white p-0.5 shadow-[0_1px_6px_rgba(0,0,0,0.1)] group-hover:bg-secondary group-focus:bg-secondary`,children:t.expand.writer.avatar?r.jsx("img",{src:E(t.expand.writer,t.expand.writer.avatar),alt:"작성자 프로필",className:"h-full w-full rounded-full object-cover text-xs"}):r.jsx(L,{className:"h-full w-full text-gray-100"})}),r.jsx("dt",{className:"sr-only",children:"작성자"}),r.jsx("dd",{className:`${n?"-mb-4 h-fit text-lg":""} col-start-2 col-end-6 font-bold`,children:t.expand.writer.nickname}),r.jsx("dt",{className:`${n?"h-fit text-sm":"text-xs font-semibold"} col-start-2 row-start-2`,children:"리뷰"}),r.jsx("dd",{className:`${n?"h-fit text-sm":"text-xs font-semibold"} col-start-3 row-start-2 text-primary`,children:x&&(x==null?void 0:x.length)}),r.jsx("dt",{className:`${n?"h-fit text-sm":"text-xs font-semibold"} col-start-4 row-start-2`,children:"팔로워"}),r.jsx("dd",{className:`${n?"h-fit text-sm":"text-xs font-semibold"} col-start-5 row-start-2 text-primary`,children:g&&g[0].followers.length})]})}),l===t.expand.writer.id?r.jsx("div",{"aria-label":"내가 쓴 리뷰",className:"text-sm text-gray-500",children:"내가 쓴 리뷰"}):h?r.jsx("button",{className:"h-8 rounded-md bg-secondary px-3 text-sm font-bold text-white hover:bg-gray-500 focus:bg-gray-500",id:t.expand.writer.id,onClick:N(o=>b(o),500),onMouseOver:()=>u(!0),onMouseOut:()=>u(!1),children:v?"언팔로우":"팔로잉"}):r.jsx("button",{className:"h-8 rounded-md border border-secondary px-3 text-sm font-bold text-secondary hover:bg-secondary hover:text-white focus:bg-secondary focus:text-white",id:t.expand.writer.id,onClick:N(o=>b(o),500),children:"팔로우"})]})}R.propTypes={item:i.shape({expand:i.shape({writer:i.shape({id:i.string,avatar:i.string,nickname:i.string})})}),isUser:i.bool};export{R as F};
