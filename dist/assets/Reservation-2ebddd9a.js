import{r as b,j as e,b as h,L as g,e as N,p as E,S as R}from"./index-06c6c1f5.js";import{N as w}from"./NoResult-cde6063e.js";import{a as O,b as V,B as A,c as v}from"./index.esm-1ff9b723.js";import{a as C,b as k}from"./index.esm-a526b47c.js";import{u as U,a as W}from"./region-43499ee0.js";import{u as B}from"./useFetchList-8f652331.js";import{d as L,t as F,c as X}from"./getDate-b10b504c.js";import{D as M,P as q}from"./PopUpModal-a427d51e.js";import{a as z,b as G}from"./index.esm-bcf7d115.js";import{S as H}from"./ScrollTop-7e4dffaf.js";import{M as J}from"./MetaData-baa07fc2.js";import"./iconBase-51491e03.js";import"./useBaseQuery-d5fe4309.js";import"./index-ea9f9059.js";import"./index-0b99c69c.js";import"./middleware-763781cb.js";import"./useQuery-7f8ad36b.js";function S({userInfo:n,visitedList:i}){const[x,r]=b.useState(!1),[l,o]=b.useState(!1);let m=i.reduce((c,p)=>(c[p.expand.place.title]=(c[p.expand.place.title]||0)+1,c),{}),d=Object.entries(m).sort((c,p)=>p[1]-c[1]),t=l?d.slice(0,8):d.slice(0,3),a=t.length!==0?t[0][1]:0;function u(){o(!l)}return e.jsxs("div",{className:"mt-8 border-b border-dashed border-gray-500/50 pb-8",children:[e.jsxs("h3",{className:"mb-6 text-lg font-bold",children:[e.jsx(C,{className:"mr-2 inline text-3xl"}),e.jsxs("p",{className:"inline align-bottom",children:[e.jsx("span",{className:"text-secondary decoration-secondary hover:underline",children:n.nickname})," 님은 LION PLACE로 ",e.jsxs("span",{className:"text-secondary decoration-secondary hover:underline",children:[i.length,"회"]})," 예약하고 방문했어요"]})]}),e.jsx("ol",{children:t.map((c,p)=>e.jsxs("li",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"mr-2 w-6 items-center rounded-lg border-2 bg-black text-center text-sm font-bold text-white",children:p+1}),e.jsx("h4",{className:"grow font-semibold",children:c[0]}),e.jsxs("p",{className:"mr-1 font-bold",children:[c[1],"회"]})]}),e.jsx("div",{className:"mt-2 h-0.5 w-full rounded-md bg-gray-200",children:e.jsx("div",{className:"h-0.5 rounded-md bg-primary",style:{width:`${Math.floor(c[1]/a*100)}%`}})})]},p))}),e.jsxs("label",{htmlFor:"seeMoreButton",className:`mx-auto flex cursor-pointer items-center justify-center gap-1 ${t.length<3?"hidden":""}`,children:[e.jsx("input",{type:"checkbox",className:"sr-only",onChange:u,id:"seeMoreButton",tabIndex:0,onFocus:()=>r(!0),onBlur:()=>r(!1)}),e.jsxs("p",{className:`flex items-center rounded-md border-2 px-1.5 hover:font-bold ${x?"border-black font-bold":"border-transparent"}`,children:[e.jsxs("span",{children:[l?"접기":"더보기"," "]}),l?e.jsx(V,{className:"inline"}):e.jsx(O,{className:"inline"})]})]})]})}S.propTypes={userInfo:h.object,visitedList:h.array};function P({userInfo:n,visitedList:i,canceledList:x}){let r,l=n.id;const[o,m]=b.useState("all"),{data:d}=B("reviews",{filter:`writer = '${l}'`,fields:"reservation"});let t=d==null?void 0:d.map(s=>s.reservation);const{data:a,isLoading:u,hasNextPage:c,fetchNextPage:p}=U("reservation",{filter:`booker="${n.id}" && (visited=true || canceled=true)`,sort:"-date"});let f=(a==null?void 0:a.flatMap(s=>s.items).filter(s=>s.canceled||s.visited))||null;switch(o){case"visit":r=f.filter(s=>s.visited)||null;break;case"cancel":r=f.filter(s=>s.canceled)||null;break;default:r=f}const $=W(async(s,y)=>{y.unobserve(s.target),c&&!u&&p()},{threshold:1});function j(s){m(s.target.value)}function I(){return e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-primary",children:e.jsx(z,{className:"text-3xl text-white"})})}function D(){return e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-gray-500",children:e.jsx(G,{className:"text-3xl text-white"})})}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-8 flex gap-2",children:[e.jsxs("label",{htmlFor:"filterAllButton",className:`rounded-xl border border-gray-200/50 px-4 py-2 text-sm font-semibold shadow-md ${o==="all"?"cursor-pointer border-0 bg-primary text-white":"cursor-pointer text-gray-600 hover:border-primary"}`,children:[e.jsx("input",{type:"radio",name:"filter",value:"all",id:"filterAllButton",onChange:j,className:"sr-only"}),e.jsx("p",{children:"전체"})]}),e.jsxs("label",{htmlFor:"filterVisitButton",className:`rounded-xl border border-gray-200/50 px-4 py-2 text-sm font-semibold shadow-md ${i.length?o==="visit"?"cursor-pointer border-0 bg-primary text-white":"cursor-pointer text-gray-600 hover:border-primary":"cursor-not-allowed bg-gray-100 text-gray-600 text-opacity-60"}`,children:[e.jsx("input",{type:"radio",name:"filter",id:"filterVisitButton",value:"visit",onChange:j,className:"sr-only"}),e.jsxs("p",{children:["방문 ",e.jsx("span",{className:"pl-0.5 font-medium",children:i.length})]})]}),e.jsxs("label",{htmlFor:"filterCancelButton",className:`rounded-xl border border-gray-200/50 px-4 py-2 text-sm font-semibold shadow-md ${x.length?o==="cancel"?"cursor-pointer border-0 bg-primary text-white":"cursor-pointer text-gray-600 hover:border-primary":"cursor-not-allowed bg-gray-100 text-gray-600 text-opacity-60"}`,children:[e.jsx("input",{type:"radio",name:"filter",id:"filterCancelButton",value:"cancel",onChange:j,className:"sr-only",disabled:!x.length}),e.jsxs("p",{children:["예약 취소 ",e.jsx("span",{className:"pl-0.5",children:x.length})]})]})]}),e.jsx("ul",{className:"mb-8",children:r==null?void 0:r.map((s,y)=>e.jsxs("li",{className:"my-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.canceled?e.jsx(D,{}):e.jsx(I,{}),e.jsxs("div",{className:"grow",children:[e.jsx("h4",{className:"font-bold",children:s.expand.place.title}),e.jsxs("p",{className:"text-sm font-light",children:[L(s.date)," ",e.jsx("span",{className:"mx-1 font-normal opacity-40",children:"|"})," ",F(s.date)]})]}),e.jsx("div",{className:"mr-1 flex gap-2 text-lg",children:e.jsx(M,{inline:!0,arrowIcon:null,label:e.jsx(k,{}),style:null,children:e.jsx(g,{to:"/reservation-write",state:{userInfo:n,item:s},children:e.jsx("p",{className:"mx-3 my-1 bg-transparent text-center text-sm font-semibold hover:text-primaryLight",children:"+ 재예약"})})})})]}),e.jsxs("div",{className:"my-2 w-full rounded-2xl border border-gray-200/50 px-4 shadow-md",children:[e.jsxs("div",{className:"flex- flex justify-center border-b border-dashed pb-3 pt-4",children:[e.jsx("p",{className:`grow ${s.canceled?"font-semibold text-gray-500":"font-semibold"}`,children:s.canceled?"예약 취소":"방문 완료"}),e.jsx(g,{to:"/review-write",state:{userId:l,item:s},children:e.jsxs("p",{className:!s.canceled&&!(t!=null&&t.includes(s.id))?"group mr-2 flex items-center text-sm font-semibold text-gray-700":"hidden",children:[e.jsx(A,{className:"mr-1 inline text-primary group-hover:text-black"})," 리뷰 작성하기"]})}),e.jsxs("p",{className:!s.canceled&&(t!=null&&t.includes(s.id))?"mr-2 flex items-center text-sm font-medium text-gray-700":"hidden",children:[e.jsx(C,{className:"mr-1 inline text-lg text-primary"}),"리뷰 등록됨"]})]}),e.jsxs("div",{className:"pb-4 pt-3",children:[e.jsx("dt",{className:"sr-only",children:"주소"}),e.jsx("dd",{className:"font-semibold",children:s.expand.place.address}),e.jsx("dt",{className:"sr-only",children:"카테고리"}),e.jsx("dd",{className:"font-semibold text-gray-600",children:s.expand.place.category})]})]})]},y))}),e.jsx("div",{ref:$,className:"h-[1px]"})]})}P.propTypes={userInfo:h.object,progressList:h.array,visitedList:h.array,canceledList:h.array};function T({reservedList:n,userInfo:i}){const[x,r]=b.useState(!1),[l,o]=b.useState(null);async function m(a){await N("reservation",a.target.closest("li").id,{visited:!0}),location.reload()}async function d(a){o(a.target.closest("li").id),r(!0)}async function t(){await N("reservation",l,{canceled:!0}),location.reload()}return e.jsx("div",{className:"border-b border-dashed border-gray-500/50 pb-8",children:n.length!==0?e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"mb-4 mt-2 text-lg font-bold",children:[e.jsx(v,{className:"mr-2 inline align-bottom text-3xl"}),e.jsx("span",{className:"mx-0.5 text-secondary decoration-secondary hover:underline",children:i.nickname}),"님이 현재 예약한 정보에요"]}),e.jsx("ul",{children:n.map((a,u)=>e.jsxs("li",{className:"my-2 rounded-2xl border-2 border-primary p-4",id:a.id,children:[e.jsx(q,{openModal:x,setOpenModal:r,modalTitle:"정말 예약을 취소하시겠어요?",actionTitle:"확인",handleEvent:t}),e.jsx("p",{className:"inline rounded-xl bg-primary px-1.5 py-0.5 text-xs font-bold text-white",children:X(a.date)}),e.jsx("div",{className:"float-right",children:e.jsxs(M,{inline:!0,arrowIcon:null,label:e.jsx(k,{}),children:[e.jsx("button",{type:"button",className:"mx-3 block border-b border-gray-500 bg-transparent py-1 text-center text-sm font-semibold hover:text-primaryLight",onClick:m,children:"방문 확인"}),e.jsx("button",{type:"button",className:"mx-3 block bg-transparent py-1 text-center text-sm font-semibold hover:text-primaryLight",onClick:d,children:"예약 취소"})]})}),e.jsx("h4",{className:"mt-1 font-bold",children:a.expand.place.title}),e.jsxs("p",{className:"text-sm font-light",children:[L(a.date)," ",e.jsx("span",{className:"mx-1 font-normal opacity-40",children:"|"}),F(a.date)]})]},u))})]}):e.jsxs("h3",{className:"mb-4 mt-2 text-lg font-bold",children:[e.jsx(v,{className:"mr-2 inline align-bottom text-3xl"}),e.jsx("span",{className:"mx-0.5 text-secondary",children:i.nickname}),"님이 현재 예약한 장소는 없어요!",e.jsx(w,{title:"회원님의 예약 정보가 없어요.",contents:"원하는 장소를 예약하고, 예약 정보를 관리해보세요!",style:"pt-4 pb-0"})]})})}T.propTypes={reservedList:h.array,userInfo:h.object};function me(){let n=E.authStore.model;const{data:i,isLoading:x}=B("reservation",{filter:`booker = '${n.id}'`,expand:"place",sort:"-date"});if(x)return e.jsx(R,{});let r=[],l=[],o=[],m=[];i.forEach(t=>{!t.canceled&&!t.visited?r=[...r,t]:l=[...l,t]}),l.forEach(t=>{t.canceled?m=[...m,t]:o=[...o,t]});const d={title:"Best Place - 방문/예약",description:"내 방문/예약 정보 확인하기",keywords:["맛집","리뷰","커뮤니티"],image:"/logo.svg"};return i.length!==0?e.jsxs("div",{children:[e.jsx(J,{props:d}),e.jsx(H,{}),e.jsx(T,{userInfo:n,reservedList:r.reverse()}),e.jsx(S,{userInfo:n,visitedList:o}),e.jsx(P,{userInfo:n,progressList:l,visitedList:o,canceledList:m})]}):e.jsx(w,{title:"회원님의 예약 정보가 없어요.",contents:"원하는 장소를 예약하고, 예약 정보를 관리해보세요!"})}export{me as default};
